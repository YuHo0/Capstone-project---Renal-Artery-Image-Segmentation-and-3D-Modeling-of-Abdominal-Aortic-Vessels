# Renal Artery Image Segmentation and 3D Modeling of Abdominal Aortic Vessels ü©∫

An integrated software system for automated medical image analysis, designed to assist preoperative planning for Abdominal Aortic Aneurysm (AAA). This project features a hybrid pipeline combining **YOLOv7 object detection**, **U-Net semantic segmentation**, and **3D STL reconstruction**.

## üèÜ Project Highlights

![Python](https://img.shields.io/badge/Python-3.8%2B-blue?style=flat-square)
![YOLOv7](https://img.shields.io/badge/Model-YOLOv4%20%2F%20v7-orange?style=flat-square)
![U-Net](https://img.shields.io/badge/Model-U--Net-yellow?style=flat-square)
![Performance](https://img.shields.io/badge/mAP-99.1%25-success?style=flat-square)
![Performance](https://img.shields.io/badge/IoU-0.932-success?style=flat-square)

## üìñ Executive Summary

**"Enhancing AAA stent placement precision through Deep Learning."**

In Endovascular Aneurysm Repair (EVAR), precise localization of the renal arteries is critical to prevent stent misplacement. This system processes raw Computed Tomography (CT) slices to automate the extraction of the abdominal aorta and renal arteries, reconstructing them into high-fidelity **3D STL models**.

**Key Technical Achievements:**
* **Optimization Strategy:** Implemented a **split-training strategy** for kidney detection, boosting mAP from ~77% (joint training) to **99.1%**.
* **Preprocessing Pipeline:** Engineered a custom contrast enhancement pipeline (Gamma Correction + Otsu‚Äôs) that improved segmentation **Mean IoU from 0.759 to 0.932**.
* **Clinical Value:** Reduces visual fatigue for radiologists by automating the ROI selection and 3D visualization process.

## üìä Performance Benchmarks

Our research compared multiple architectures and training strategies. The final deployed model achieved state-of-the-art performance on our clinical dataset:

| Task | Model | Strategy | Metric | Result |
| :--- | :--- | :--- | :--- | :--- |
| **Kidney Detection** | **YOLOv7** | **Split-Training (Right)** | **mAP@0.5** | **99.1%** |
| Kidney Detection | YOLOv7 | Joint-Training | mAP@0.5 | 77.3% |
| **Vessel Segmentation** | **U-Net** | **Custom Preprocessing** | **Mean IoU** | **0.932** |
| Vessel Segmentation | U-Net | Raw Images | Mean IoU | 0.759 |

## üì∏ Visual Demonstration

### 1. System GUI Interface
*(The interface allows users to load DICOM series, visualize detection results, and export 3D models.)*

<p align="center">

  <img src="/Renal-Aorta-3D-System/assets/GUI_SCREENSHOT_LINK1.png" alt="Graphical User Interface Screenshot" width="300"/>

  <img src="/Renal-Aorta-3D-System/assets/GUI_SCREENSHOT_LINK2.png" alt="Graphical User Interface Screenshot" width="300"/>

  <img src="/Renal-Aorta-3D-System/assets/GUI_SCREENSHOT_LINK3.png" alt="Graphical User Interface Screenshot" width="300"/>
  <br>
  <em>Figure 1: PyQt5-based GUI showing the automated workflow.</em>
</p>

### 2. Segmentation & 3D Reconstruction
*(From 2D CT Slices to 3D Hollow Vessel Model)*

<p align="center">

  <img src="/Renal-Aorta-3D-System/assets/THREE_D_MODEL_LINK1.png" alt="Final 3D Aorta Model" width="400"/>

  <img src="/Renal-Aorta-3D-System/assets/THREE_D_MODEL_LINK2.jpg" alt="Final 3D Aorta Model" width="400"/>
  <br>
  <em>Figure 2: The final STL model generated by stacking voxel points and triangular mesh reconstruction.</em>
</p>

## ‚öôÔ∏è Technical Architecture & Methodology

The system follows a multi-stage pipeline designed to filter irrelevant data and focus computing power on the Region of Interest (ROI).

### Phase 1: Intelligent Localization (The "Funnel" Approach)
Instead of processing every slice, we filter data hierarchically:
1.  **Spine Detection (YOLOv4):** Identifies the thoracic and lumbar vertebrae to establish a baseline anatomical position.
2.  **Kidney Localization (YOLOv7):** Detects kidneys to further narrow down the ROI to the abdominal aorta section.
    * *Innovation:* We utilized a **Split-Training Strategy**, training separate models for left and right kidneys to handle anatomical asymmetry, achieving **99.1% mAP**.

### Phase 2: Advanced Preprocessing
To address the low contrast of soft tissues in CT scans:
* **Linear Transformation:** DICOM to BMP conversion (Window Level: 300, Window Width: 600).
* **Contrast Enhancement:** Applied **Gamma Correction (Œ≥=0.1)** followed by **Otsu‚Äôs Binarization**.
* *Impact:* This step was crucial in separating the vascular structure from the background, directly contributing to the **17% increase in IoU**.

### Phase 3: Semantic Segmentation (U-Net)
* **Target:** Pixel-level segmentation of the aorta and the aorta-renal connection points.
* **Method:** A U-Net architecture trained on the preprocessed ROI slices creates binary masks of the blood flow lumen.

### Phase 4: 3D Reconstruction
* **Morphological Processing:** Applied **Erosion** to simulate the hollow structure of actual blood vessels.
* **Voxelization:** Stacked 2D masks along the Z-axis, adjusting for the 5mm slice thickness (Z-axis expansion).
* **Mesh Generation:** Constructed a triangular mesh surface to export the final **STL model**.

## üõ†Ô∏è Key Libraries & Tools
* **UI Framework:** PyQt5
* **Deep Learning:** PyTorch, Darknet (YOLOv4/v7 integration)
* **Computer Vision:** OpenCV (Edge detection, Morphology), SimpleITK (DICOM handling)
* **Data Processing:** NumPy, Pandas
* **3D Modeling:** NumPy-STL

## üìù Author's Note

The full academic report is available in the `docs/` folder (in Traditional Chinese). This repository, including the code structure and this README, serves as the English technical summary demonstrating my skills in deep learning implementation, computer vision, and full-stack system integration.
